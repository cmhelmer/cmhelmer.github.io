.main-doc {
	width: 100%; // for flexbox
	> * {
		@include gutter( .5 ); // split with body
	}
}

.doc-header {
	> * {
		@include measure;
	}
	.doc-meta {
		margin-top: $gap;
	}
	figcaption {
		margin-top: 0; // override
	}
}

.doc-collection {
	@include font-smcp;
// 	color: $color-accent;
	a {
		text-decoration: none;
	}
}

.doc-id {
	// Would make this smcp but Source Sans Pro (unlike Source Serif Pro) doesn't have tnum for smcp
	@include font-feature-settings( lnum, tnum ); // lining, tabular numbers
// 	letter-spacing: .03125em;
	color: $color-accent;
}

.doc-index {
	@include flex;
	max-width: none; // override
	color: $color-accent;
	border-top: $border-width $border-style;
	> .doc-meta {
		width: 50%;
		margin-top: 0; // override
	}
	> :last-child {
		text-align: right;
	}
}

.doc-image {
	max-width: none; // override
	width: 100%;
	> img {
		width: 100%;
		border-radius: ( $border-radius * 2 );
	}
}

.doc-title {
	@include font-size( 1.5 );
	max-width: ( $measure * 1.5 );
// 	text-align: center;
	&:not(:first-child) {
		margin-top: $gap; // fallback for calc
		margin-top: $gutter;
	}
	/*
	.title {}
	.title-separator {}
	.subtitle {
		font-weight: normal;
	}
	*/
}

.doc-byline {
	@include flex;
	@include font-small;
	@include dim;
	> * {
		margin-top: 0; // override
	}
	.doc-author {
		display: none; // hide on single-author site but keep in html for scrapers
	}
}

.doc-content {
	// tomfoolery, no doubt, but gives as much flexibility as possible
	> * {
		@include measure;
	}
	h1 {
		@include font-size( 1.25 );
	}
	h2 {
		@include font-size( 1.125 );
	}
	h3 {
		@include font-size( 1.0625 );
	}
	figure,
	table {
		@include measure( 1.5 );
	}
	iframe {
		@include measure( 1.5 );
		width: 100%;
	}
	* + *,
	li + li > p,
	dd + dd > p {
		margin-top: $gap;
	}
	* + li,
	* + dd,
	dt + dt,
	figcaption,
	li > ul,
	li > ol {
		margin-top: 0; // override, unless there are child <p> (above)
	}
	> .highlighter-rouge {
		max-width: ( $measure + ( $gap * 2 ) );
	}
}

pre + .output,
.highlighter-rouge + .output {
	border: $border-width dotted; // match color of pre?
	position: relative;
	// Downward arrow
	&::before {
		position: absolute;
		content: '';
		width: ( $gap / 3 );
		height: ( $gap / 3 );
		left: 50%;
		bottom: 100%;
		transform: translateX(-50%) rotate(45deg);
		transform-origin: center;
		border: inherit;
		border-top: 0;
		border-left: 0;
// 		border-radius: $border-radius;
	}
	&::after {
		position: absolute;
		content: '';
		left: 50%;
		bottom: 100%;
		transform: translateX(-50%); // absolute center
		height: ( $gap + $border-width );
		border-left: inherit;
	}
}

.ref {
	font-style: normal;
}

// Footnotes
.footnotes {
	@include font-small;
	@extend hr;
	padding-top: ( $gap * 2 );
}

// Inline footnote overlays (placed by script.js)
.sup-footnote {
	position: relative;
}

.footnote {
	position: relative;
	z-index: 1001; // above .aside-foonote
}

// TEMP
[data-footnote]:hover {
	&::after {
		content: attr(data-footnote);
	}
}

.aside-footnote {
	visibility: hidden; // accessible
	@include font-body; // override sup
	@include font-small;
	position: absolute;
	z-index: 1000;
	left: 50%;
	bottom: 100%;
	transform: translateX(-50%);
	margin-bottom: ( $gap / 2 );
	padding: ( $gap / 2 );
	width: 17rem; // to taste; within 320px
	color: $color-bg;
	background: $color-text;
	border-radius: $border-radius;
	box-shadow: 0 0 ( $gap / 2 ) $color-text-bg;
	// Extend overlay
	&::before {
		position: absolute;
		content: "";
		z-index: -1;
		top: ( $gap / -1 );
		left: ( $gap / -1 );
		right: ( $gap / -1 );
		bottom: ( $gap / -1 );
	}
	// Cute little speech triangle
	&::after {
		content: "";
		position: absolute;
		top: 100%;
		left: 50%;
		transform: translateX(-50%) rotate(-45deg);
		transform-origin: top left;
		width: .5rem;
		height: .5rem;
		border-bottom-left-radius: inherit;
		background: inherit;
		box-shadow: inherit;
	}
	// Show overlay
	.footnote:hover ~ &,
	.footnote:focus ~ &,
	.footnote:active ~ &,
	&:hover,
	&:focus,
	&:active,
	&:target {
		visibility: visible;
	}
	&:target {
		z-index: 999; // in case of subsequent footnote references
	}
}

.doc-footer {
	@include flex;
	@include measure;
	@include gutter( .5 );
	margin-top: ( $gap * 1.5 ); // fallback for calc
	margin-top: calc(#{$gutter} + #{$gap * .5}); // in place of padding-top + some
	border-top: $border-width $border-style;
	.doc-meta {
		a {
			white-space: nowrap;
		}
	}
}

.main-aside {
	width: 100%; // for flexbox
	> * {
		@include measure;
		@include gutter( .5 ); // split with body
		&:not(:first-child) {
			padding-top: $gap; // override
		}
		&:not(:last-child) {
			padding-bottom: 0; // override
		}
	}
}

.aside-content {
	* + *:not(li) {
		margin-top: $gap;
	}
}
