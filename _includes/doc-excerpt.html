{%- comment -%}

Include document excerpt

Roll our own excerpt in order to use custom metadata and content filters
Prefer "description" set in metadata (not "excerpt", which is set by Jekyll and not useful to us)

- Pass in document (optional)

{%- endcomment -%}

{%- if include.doc -%}
	{%- assign doc = include.doc -%}
{%- else -%}
	{%- assign doc = page -%}
{%- endif -%}

{%- capture doc_excerpt -%}

{%- if doc.description != nil -%}

	{{ doc.description }}

{%- else -%}

	{%- comment -%} Get content to render custom markdown {%- endcomment -%}

	{%- capture doc_content -%}{%- include doc-content.html doc=doc render=true -%}{%- endcapture-%}

	{%- comment -%} Strip and trim to string before first separator {%- endcomment -%}

	{{ doc_content | strip_html | strip | split: site.excerpt_separator | first }}

{%- endif -%}

{%- endcapture -%}

{%- assign excerpt_length = site.excerpt_length | default: include.excerpt_length | default: 140 -%}

{{- doc_excerpt | strip_html | normalize_whitespace | strip | truncate: excerpt_length -}}
