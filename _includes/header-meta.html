{%- comment -%}

Include header meta
Necessary if filters are used (title, date, content, excerpt)

Some ideas taken from "jekyll-seo-tag" plugin by Ben Balter

{%- endcomment -%}

{%- if page.title -%}
{%- capture page_title -%}{%- include filter-title.html my_doc=page -%}{%- endcapture -%}
{%- endif -%}
{%- capture meta_title -%}
	{%- if page_title -%}
		{{- page_title -}}
		{{- " " -}}
		{{- site.title_separator | default: "|" -}}
		{{- " " -}}
	{%- endif -%}
	{{- site.title -}}
{%- endcapture -%}
<title>{{ meta_title | strip_html | strip }}</title>
<meta property="og:site_name" content="{{ site.title }}">
{%- if page_title -%}
<meta property="og:title" content="{{ page_title | strip | escape }}">
{%- endif -%}

{%- if page.content -%}
	{%- capture meta_description -%}
		{%- if page.content != empty or page.description -%}
			{%- include filter-excerpt.html my_doc=page -%}
		{%- else -%}
			{{ site.description }}
		{%- endif -%}
	{%- endcapture -%}
{%- endif -%}
{%- unless meta_description == empty -%}
<meta name="description" content="{{ meta_description | strip | escape }}">
<meta property="og:description" content="{{ meta_description | strip | escape }}">
{%- endunless -%}

{%- if page.tags -%}
<meta name="keywords" content="{{ page.tags | join: ', ' | escape }}">
{%- endif -%}

{%- if page.collection -%}
<meta name="collection" content="{{ site.collections | where: 'label', page.collection | map: 'title' | first | default: page.collection | escape }}">
{%- endif -%}

<meta name="author" content="{{ page.author.name | default: page.author | default: page.authors.first.name | default: page.authors.first | default: site.author.name | default: site.author | escape }}">

{%- if page.date and page.date != site.time -%}
<meta property="og:type" content="article">
<meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
{%- endif -%}

{%- if page.updated -%}
<meta name="revised" content="{{ page.updated | date_to_xmlschema }}">
{%- endif -%}

<meta property="og:locale" content="{{ page.lang | default: site.lang | default: 'en' | replace:'-','_' }}">

{%- if site.url -%}
<link rel="canonical" href="{{ page.url | site.url | absolute_url }}">
<meta property="og:url" content="{{ page.url | site.url | absolute_url }}">
{%- endif -%}

{%- if page.previous -%}
<link rel="prev" href="{{ page.previous.url | absolute_url }}">
{%- endif -%}
{%- if page.next -%}
<link rel="next" href="{{ page.next.url | absolute_url }}">
{%- endif -%}

{%- if site.author.facebook -%}
{%- if site.author.facebook.admins -%}
<meta property="fb:admins" content="{{ site.author.facebook.admins }}">
{%- endif -%}

{%- if site.author.facebook.publisher -%}
<meta property="article:publisher" content="{{ site.author.facebook.publisher }}">
{%- endif -%}

{%- if site.author.facebook.app_id -%}
<meta property="fb:app_id" content="{{ site.author.facebook.app_id }}">
{%- endif -%}
{%- endif -%}

{%- if site.author.microblog -%}
<link href="https://micro.blog/{{ site.author.microblog }}" rel="me">
{%- endif -%}

{%- if site.verifications -%}
{%- for verification in site.verifications -%}
<meta name="{{ verification.name | escape }}" content="{{ verification.content | escape }}">
{%- endfor -%}
{%- endif -%}

<meta name="generator" content="Jekyll v{{ jekyll.version }}">
<meta name="designer" content="C. M. Helmer">
<link rel="author" href="humans.txt">

{%- comment -%}

{%- if seo_tag.image -%}
<meta property="og:image" content="{{ seo_tag.image.path }}">
{%- if seo_tag.image.height -%}
<meta property="og:image:height" content="{{ seo_tag.image.height }}">
{%- endif -%}
{%- if seo_tag.image.width -%}
<meta property="og:image:width" content="{{ seo_tag.image.width }}">
{%- endif -%}
{%- endif -%}


{%- if site.author.twitter -%}
{%- if seo_tag.image -%}
<meta name="twitter:card" content="summary_large_image">
{%- else -%}
<meta name="twitter:card" content="summary">
{%- endif -%}

<meta name="twitter:site" content="@{{ site.author.twitter | replace:"@","" }}">

{%- if seo_tag.author.twitter -%}
<meta name="twitter:creator" content="@{{ seo_tag.author.twitter }}">
{%- endif -%}
{%- endif -%}


<script type="application/ld+json">
{{ seo_tag.json_ld | jsonify }}
</script>

{%- endcomment -%}
