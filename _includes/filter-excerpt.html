{%- comment -%}

Filter excerpt
Roll our own excerpt in order to use custom content filter
Prefer description set in metadata (not excerpt, which is set by Jekyll and not useful to us)
- Pass in unrendered content
- Capture this include and use "strip" filter to remove whitespace.

{%- endcomment -%}

{%- assign my_doc = include.my_doc -%}

{%- capture my_excerpt -%}

{%- if my_doc.description != nil -%}

	{{ my_doc.description }}

{%- else -%}

	{%- comment -%} Render and strip {%- endcomment -%}
	{%- assign my_content = my_doc.content | markdownify | strip_html | strip -%}
	
	{%- comment -%} Trim to string before first separator {%- endcomment -%}
	{%- assign my_excerpt = my_content | split: site.excerpt_separator | first -%}
	
	{%- comment -%} Filter as content to remove custom markup {%- endcomment -%}
	{%- include filter-content.html my_content=my_excerpt -%}
	
{%- endif -%}

{%- endcapture -%}

{% assign excerpt_length = site.excerpt_length | default: include.excerpt_length | default: 140 %}

{{- my_excerpt | strip_html | normalize_whitespace | strip | truncate: excerpt_length -}}
